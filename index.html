<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CYBER-Coin Wallet</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-black text-green-400 min-h-screen flex items-center justify-center">

<div class="bg-zinc-900 rounded-2xl shadow-xl p-6 w-full max-w-lg text-center">

<h1 class="text-3xl font-bold mb-2">ðŸš€ CYBER-Coin Wallet</h1>
<p class="text-sm text-zinc-400 mb-4">Live Kurs + Wallet</p>

<div id="price" class="text-5xl font-mono mb-2">LÃ¤dt...</div>
<p class="text-xs text-zinc-500 mb-4">1 CYBER = CHF</p>

<canvas id="chart" height="120"></canvas>

<div class="mt-4">
<input id="amount" type="number" placeholder="Menge" class="w-full bg-black border border-zinc-700 rounded-xl p-2 text-center">
<button onclick="convert()" class="mt-2 bg-green-500 text-black px-3 py-2 rounded-xl hover:bg-green-400">Umrechnen</button>
<p id="result" class="mt-2 text-zinc-400"></p>
</div>

<div class="mt-6 border-t border-zinc-700 pt-4">
<h2 class="font-bold mb-2">Wallet</h2>
<p id="wallet" class="mb-2 text-zinc-400">0 CYBER</p>
<button onclick="buyCoins()" class="bg-blue-500 px-3 py-2 rounded-xl hover:bg-blue-400 mr-2">Coins kaufen</button>
<button onclick="redeemCoins()" class="bg-red-500 px-3 py-2 rounded-xl hover:bg-red-400">Coins einlÃ¶sen</button>

<div class="mt-4" id="twintDiv" style="display:none;">
<p class="text-xs text-zinc-400 mb-1">Scanne QR fÃ¼r TWINT:</p>
<img src="twint-qr.png" alt="TWINT QR" class="mx-auto rounded-xl max-w-[200px]"/>
</div>

</div>

<p class="mt-4 text-xs text-zinc-600" id="updated"></p>

</div>

<script>
const apiURL = "https://cyber-coin-2026.vercel.app/api-price";
let chart;
let prices = [];
let labels = [];
let currentPrice = 0;

// Local Wallet
function getWallet() {
  const wallet = JSON.parse(localStorage.getItem("cyberWallet") || "0");
  return wallet;
}
function setWallet(value) {
  localStorage.setItem("cyberWallet", JSON.stringify(value));
  document.getElementById("wallet").innerText = value.toFixed(3) + " CYBER";
}

// Load price
async function loadPrice() {
  try {
    const res = await fetch(apiURL);
    const data = await res.json();

    currentPrice = data.price_chf;
    document.getElementById("price").innerText = currentPrice.toFixed(3);
    document.getElementById("updated").innerText =
      "Letztes Update: " + new Date(data.updated).toLocaleTimeString();

    prices.push(currentPrice);
    labels.push(new Date().toLocaleTimeString());
    if (prices.length > 30) { prices.shift(); labels.shift(); }
    updateChart();
  } catch {
    document.getElementById("price").innerText = "Server Fehler";
  }
}

// Chart
function updateChart() {
  const ctx = document.getElementById("chart");
  if (!chart) {
    chart = new Chart(ctx, {
      type:"line",
      data:{labels, datasets:[{data:prices,borderColor:"#22c55e",tension:0.3}]},
      options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}
    });
  } else { chart.data.labels = labels; chart.data.datasets[0].data = prices; chart.update(); }
}

// Umrechnen
function convert() {
  const amount = Number(document.getElementById("amount").value);
  if(!amount||!currentPrice) return;
  document.getElementById("result").innerText = amount+" CYBER = "+(amount*currentPrice).toFixed(2)+" CHF";
}

// Coins kaufen
function buyCoins() {
  document.getElementById("twintDiv").style.display="block";
  const coinsToAdd = Number(prompt("Wie viele CYBER-Coins kaufen?","10"));
  if(coinsToAdd>0){
    const wallet = getWallet();
    setWallet(wallet + coinsToAdd);
    alert(coinsToAdd + " CYBER-Coins wurden deinem Wallet hinzugefÃ¼gt!");
  }
}

// Coins einlÃ¶sen
function redeemCoins() {
  const wallet = getWallet();
  const coinsToRedeem = Number(prompt("Wie viele CYBER-Coins einlÃ¶sen?",wallet));
  if(coinsToRedeem>0 && coinsToRedeem <= wallet){
    setWallet(wallet - coinsToRedeem);
    const chf = coinsToRedeem * currentPrice;
    alert(coinsToRedeem + " CYBER-Coins eingelÃ¶st = " + chf.toFixed(2) + " CHF");
  } else {
    alert("Nicht genug Coins im Wallet!");
  }
}

// Init
setWallet(getWallet());
setInterval(loadPrice,3000);
loadPrice();
</script>

</body>
</html>
